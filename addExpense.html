<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add Expense</title>
    <link rel="stylesheet" href="./css/ws11.css">
    <script src="./js/ws11.js" defer></script>
</head>
<body>
    <nav class="navbar">
        <div>
            <a href="./ws11.html">Home</a>
            <a href="./user.html">UserDetail</a>
            <a href="./addExpense.html">ExpenseMade</a>
            <a href="./summary.html">Summary</a>
            <a href="#" id="exitApp">Exit</a>
        </div>
        <div class="nav-info">
            <span class="username-display"></span>
            <span class="datetime-display"></span>
        </div>
    </nav>

    <div class="container">
        <h2>Add Expense</h2>
        <form id="expenseForm">
            <div>
                <label for="expenseAmount">Amount (nnn.nn):</label>
                <input type="number" id="expenseAmount" step="0.01" min="0.01" required 
                    pattern="^\d{1,3}\.\d{2}$" title="e.g., 123.45">
            </div>
            <div>
                <label for="expenseCategory">Category:</label>
                <select id="expenseCategory" required>
                    <option value="" disabled selected>Select category</option>
                    <option value="Food">Food</option>
                    <option value="Stationary">Stationary</option>
                    <option value="Entertainment">Entertainment</option>
                    <option value="Travel">Travel</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div>
                <label for="expenseDate">Date (1/10/24 to today):</label>
                <input type="date" id="expenseDate" required>
            </div>
            <button type="submit" id="saveExpenseBtn">Save</button>
            <button type="button" id="addAnotherExpenseBtn">Add Another</button>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('expenseForm');
            const dateInput = document.getElementById('expenseDate');

            // Set the required date limits dynamically
            const currentDate = new Date();
            const minDate = new Date(2024, 9, 1); // 1st October 2024 (Month is 0-indexed)

            const formatDate = (date) => {
                const y = date.getFullYear();
                const m = String(date.getMonth() + 1).padStart(2, '0');
                const d = String(date.getDate()).padStart(2, '0');
                return `${y}-${m}-${d}`;
            };
            dateInput.min = formatDate(minDate);
            dateInput.max = formatDate(currentDate);

            form.addEventListener('submit', (e) => {
                e.preventDefault();
                if (form.checkValidity()) {
                    const newExpense = {
                        amount: parseFloat(document.getElementById('expenseAmount').value).toFixed(2),
                        category: document.getElementById('expenseCategory').value,
                        date: document.getElementById('expenseDate').value
                    };

                    const expenses = JSON.parse(localStorage.getItem(EXPENSES_KEY)) || [];
                    expenses.push(newExpense);
                    localStorage.setItem(EXPENSES_KEY, JSON.stringify(expenses));

                    alert(`Expense of â‚¹${newExpense.amount} saved.`);
                    form.reset();
                } else {
                    alert('Please check all input fields and the date range.');
                }
            });

            document.getElementById('addAnotherExpenseBtn').addEventListener('click', () => form.reset());
        });
    </script>
</body>
</html>